<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte des Arrondissements de Paris</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js"></script>
    <style>
        #map { height: 600px; width: 100%; }
    </style>
</head>
<body>
    <header>JetLag Paris</header>
    <div id="map"></div>

    <script>
        // ðŸ”¥ Firebase Config (Replace with your actual credentials)
        const firebaseConfig = {
            apiKey: "AIzaSyCa_ZyiBM1zXxnZaynA74pzUPvdEPzBP8M",
            authDomain: "jetlag-paris.firebaseapp.com",
            databaseURL: "https://jetlag-paris-default-rtdb.firebaseio.com",
            projectId: "jetlag-paris",
            storageBucket: "jetlag-paris.appspot.com",
            messagingSenderId: "955294061603",
            appId: "1:955294061603:web:7578b07b226fac045bcd96",
            measurementId: "G-D9S5Z074PZ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        var map = L.map('map').setView([48.8566, 2.3522], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        var colors = ["blue", "red", "green"];
        var arrondissementLayers = {};

        // Fetch arrondissements from GeoJSON
        fetch('arrondissements.geojson')
            .then(response => response.json())
            .then(data => {
                L.geoJson(data, {
                    style: function (feature) {
                        return { fillColor: "blue", color: "black", weight: 1, fillOpacity: 0.6 };
                    },
                    onEachFeature: function (feature, layer) {
                        const id = feature.properties.c_ar; // Use arrondissement code as ID
                        arrondissementLayers[id] = layer;

                        // Sync color with Firebase
                        db.ref('arrondissements/' + id).on('value', snapshot => {
                            if (snapshot.exists()) {
                                layer.setStyle({ fillColor: snapshot.val() });
                            }
                        });

                        // Change color on click & update Firebase
                        layer.on('click', function () {
                            db.ref('arrondissements/' + id).once('value', snapshot => {
                                let currentColor = snapshot.exists() ? snapshot.val() : "blue";
                                let newColor = colors[(colors.indexOf(currentColor) + 1) % colors.length];
                                db.ref('arrondissements/' + id).set(newColor);
                            });
                        });
                    }
                }).addTo(map);
            })
            .catch(error => console.error('Erreur lors du chargement du GeoJSON:', error));

    </script>
</body>
</html>
